<template name="events">
  {{> collectionByRecurringEvent
    allRoute="events"
    categoryRoute="eventsByRecurringEvent"
    newRoute="eventsNew"
    title=title
    emptyText="Pas d'évènements."
    items=eventOccurences
    itemTemplate="_eventOccurence"
  }}
</template>

<template name="_eventOccurence">
  <a class="collection-item event-occurence" href="{{pathFor 'eventsEdit'}}">
    {{dateFormat date format="LL"}}
    {{#if isActiveRoute regex="events$"}}
    <div>
        <span class="tag shades-text text-white grey darken-1">{{recurringEvent.name}}</span>
    </div>
    {{/if}}
  </a>
</template>

<template name="eventsNew">
  <div class="row">
    <div class="col s12">
      {{>_eventsForm}}
    </div>
  </div>
</template>

<template name="eventsEdit">
  <div class="row">
    <div class="col s12">
      {{>_eventsForm}}
    </div>
  </div>
</template>

<template name="_eventsForm">
  {{#autoForm id="eventForm" collection=collection doc=eventOccurence type=operation}}
    {{> afFieldInput name='recurringEventId' type="hidden"}}
    <div class="row">
      <div class="input-field col s12 m6">
        <input type="text" name="typeaheadRecurringEvent" value="{{eventOccurence.recurringEvent.name}}" />
        <label class="{{#if eventOccurence.recurringEventId}}active{{/if}}" for="typeaheadRecurringEvent">{{afFieldLabelText name='recurringEventId'}}</label>
        {{#if afFieldIsInvalid name='recurringEventId'}}
        <p class="help-block red-text">{{{afFieldMessage name='recurringEventId'}}}</p>
        {{/if}}
      </div>
      <div class="input-field col s12 m6">
        <i class="mdi-action-event prefix"></i>
        {{> afFieldInput name='date' type="pickadate"}}
        <label for="date">{{afFieldLabelText name='date'}}</label>
        {{#if afFieldIsInvalid name='date'}}
        <p class="help-block red-text">{{{afFieldMessage name='date'}}}</p>
        {{/if}}
      </div>
    </div>
    {{#if recurringEventId}}
    <div class="row">
      <div class="col s12">
        <h5>Participants</h5>
      </div>
      <div class="col s12">
        {{> _newParticipantTypeahead}}
        <div class="col s12">
          <p class="blue-text">Cochez les personnes présentes</p>
          {{> afQuickField name='participantsIds' label=false type="select-checkbox" options=getParticipants}}
        </div>
      </div>
    </div>
    {{else}}
    <p class="blue-text">Choisissez un évènement recurrent pour sélectionner des participants</p>
    {{/if}}
    <div class="row">
      <div class="col s12">
        {{> _submit}}
        {{#afModal class="btn left red" collection="MS.EventOccurences" operation="remove" title=" " buttonContent="Supprimer" prompt="Êtes-vous sûr ?" doc=eventOccurence._id}}
          <i class="mdi-action-delete"></i> Supprimer
        {{/afModal}}
        <a class="btn left grey" href="#"><i class="mdi-social-share"></i> Partager</a>
      </div>
    </div>
  {{/autoForm}}
</template>

<template name="_newParticipantTypeahead">
  <div class="input-field col s12">
    <input type="text" id="newParticipant" name="newParticipant" />
    <label for="newParticipant">Nom et prénom d'un nouveau participant</label>
  </div>
</template>

<template name="eventActions">
  <a class="button-in-header right hide-on-large-only" href="#"><i class="mdi-action-delete"></i></a>
  <a class="button-in-header right hide-on-large-only" href="#"><i class="mdi-social-share"></i></a>
</template>
