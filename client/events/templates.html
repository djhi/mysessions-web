<template name="events">
  <div class="collection with-header">
    <div class="collection-header">
      {{> _recurringEventMenu allRoute='events' categoryRoute='eventsByRecurringEvent'}}
      <h4>
        {{> _recurringEventFilterButton}}
        {{$.Session.get 'title'}}
      </h4>
    </div>
    {{#unless eventOccurences.count}}
      <div class="collection-item">
        Pas d'évènements.
      </div>
    {{/unless}}
    {{#each eventOccurences}}
      {{>_eventOccurence}}
    {{/each}}
    <a href="{{pathFor 'eventsNew'}}" class="btn-floating btn-large waves-effect waves-light red"><i class="mdi-content-add"></i></a>
  </div>
</template>

<template name="_eventOccurence">
  <a class="collection-item event-occurence" href="{{pathFor 'eventsEdit'}}">
    {{#if isActiveRoute regex="events$"}}{{recurringEvent.name}} -{{/if}} {{dateFormat date format="LL"}}
  </a>
</template>

<template name="eventsNew">
  <div class="row">
    <div class="col s12">
      {{>_eventsForm}}
    </div>
  </div>
</template>

<template name="eventsEdit">
  <div class="row">
    <div class="col s12">
      {{>_eventsForm}}
    </div>
  </div>
</template>

<template name="_eventsForm">
  {{#autoForm id="eventForm" collection=collection doc=eventOccurence type=operation}}
    {{> afFieldInput name='recurringEventId' type="hidden"}}
    <div class="row">
      <div class="input-field col s12 m6">
        <input type="text" name="typeaheadRecurringEvent" value="{{eventOccurence.recurringEvent.name}}" />
        <label class="{{#if eventOccurence.recurringEventId}}active{{/if}}" for="typeaheadRecurringEvent">{{afFieldLabelText name='recurringEventId'}}</label>
        {{#if afFieldIsInvalid name='recurringEventId'}}
        <p class="help-block red-text">{{{afFieldMessage name='recurringEventId'}}}</p>
        {{/if}}
      </div>
      <div class="input-field col s12 m6">
        <i class="mdi-action-event prefix"></i>
        {{> afFieldInput name='date' type="pickadate"}}
        <label for="date">{{afFieldLabelText name='date'}}</label>
        {{#if afFieldIsInvalid name='date'}}
        <p class="help-block red-text">{{{afFieldMessage name='date'}}}</p>
        {{/if}}
      </div>
    </div>
    <div class="row">
      <div class="col s12">
        <h5>Participants</h5>
      </div>
      <div class="col s12">
        {{#afModal class="waves-effect btn grey" collection="MS.Participants" operation="insert" omitFields="userId,eventOccurencesIds,recurringEventsIds" buttonContent=addParticipantButton}}
          {{_ 'addParticipant'}}
        {{/afModal}}
        {{> afQuickField name='participantsIds' label=false type="select-checkbox" options=getParticipants}}
      </div>
    </div>
    {{> _submit}}
  {{/autoForm}}
</template>
